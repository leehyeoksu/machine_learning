# í–‰ë ¬ ë¯¸ë¶„ ì‹œê°ì  ê°€ì´ë“œ ğŸ“Š
## Visual Guide to Matrix Gradients

ë‹¹ì‹ ì˜ ì§ˆë¬¸ì„ ì •í™•íˆ ì´í•´í–ˆìŠµë‹ˆë‹¤. ì‹œê°ì ìœ¼ë¡œ ì„¤ëª…í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤! 

---

## ğŸ¯ í•µì‹¬ ì§ˆë¬¸

> **"axë‚˜ x^T Î¸ë¥¼ ë¯¸ë¶„í•  ë•Œ, ë‘ ê°œê°€ ëª¨ë‘ í–‰ë ¬ì´ë©´ ê° elementë¥¼ ë¯¸ë¶„í•´ì•¼ í•˜ëŠ”ê°€?"**

**ë‹µ: ë„¤, ë§ìŠµë‹ˆë‹¤! í•˜ì§€ë§Œ íŒ¨í„´ì´ ìˆì–´ì„œ ê°„ë‹¨í•©ë‹ˆë‹¤.**

---

## ğŸ“ Case 1: ë²¡í„° Ã— ë²¡í„° (ë‹¹ì‹ ì´ ì´í•´í•œ ë¶€ë¶„)

### ì˜ˆì œ: `a Â· x` where `a = [x, y, z]`, `x^T = [1, 2, 3]`

```
f = a Â· x = xÂ·1 + yÂ·2 + zÂ·3
```

**ë¯¸ë¶„:**
```
âˆ‚f/âˆ‚a = [âˆ‚f/âˆ‚x, âˆ‚f/âˆ‚y, âˆ‚f/âˆ‚z]
       = [1, 2, 3]
       = x^T  âœ…
```

**ì´í•´ í¬ì¸íŠ¸:**
- Input: ë²¡í„° `a` (3ê°œ ì›ì†Œ)
- Output: ìŠ¤ì¹¼ë¼ `f` (1ê°œ ê°’)
- Gradient: ë²¡í„° (3ê°œ ì›ì†Œ) â† **ì›ë˜ ë³€ìˆ˜ì™€ ê°™ì€ í¬ê¸°!**

---

## ğŸ“Š Case 2: í–‰ë ¬ â†’ ìŠ¤ì¹¼ë¼ (ì—¬ê¸°ê°€ í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„!)

### ì˜ˆì œ 1: `A`ê°€ 2Ã—2 í–‰ë ¬

```
A = [a  b]    X = [w  x]  (XëŠ” ê³ ì •)
    [c  d]        [y  z]

f(A) = tr(AX)  â† ìŠ¤ì¹¼ë¼ ì¶œë ¥
```

**Step 1: AX ê³„ì‚°**
```
AX = [a  b] [w  x]  =  [aw+by  ax+bz]
     [c  d] [y  z]     [cw+dy  cx+dz]
```

**Step 2: Trace ê³„ì‚°**
```
tr(AX) = (aw+by) + (cx+dz)
       = aw + by + cx + dz  â† ìŠ¤ì¹¼ë¼!
```

**Step 3: ê° elementë³„ë¡œ ë¯¸ë¶„**
```
âˆ‚f/âˆ‚a = w
âˆ‚f/âˆ‚b = y
âˆ‚f/âˆ‚c = x
âˆ‚f/âˆ‚d = z
```

**Step 4: Gradient í–‰ë ¬ë¡œ ì¡°ë¦½**
```
âˆ‚f/âˆ‚A = [âˆ‚f/âˆ‚a  âˆ‚f/âˆ‚b]  =  [w  y]  =  X^T âœ…
        [âˆ‚f/âˆ‚c  âˆ‚f/âˆ‚d]     [x  z]
```

**ê²°ë¡ :**
```
âˆ‚tr(AX)/âˆ‚A = X^T
```

---

### ì˜ˆì œ 2: `A`ê°€ 2Ã—4, `X`ê°€ 4Ã—2

```
A = [aâ‚ aâ‚‚ aâ‚ƒ aâ‚„]    X = [xâ‚ xâ‚‚]
    [bâ‚ bâ‚‚ bâ‚ƒ bâ‚„]        [xâ‚ƒ xâ‚„]
                         [xâ‚… xâ‚†]
                         [xâ‚‡ xâ‚ˆ]
```

**AX ê³„ì‚°:**
```
AX = 2Ã—2 í–‰ë ¬
```

**tr(AX) ê³„ì‚°:**
```
tr(AX) = (AX)â‚â‚ + (AX)â‚‚â‚‚
       = (aâ‚xâ‚ + aâ‚‚xâ‚ƒ + aâ‚ƒxâ‚… + aâ‚„xâ‚‡) + (bâ‚xâ‚‚ + bâ‚‚xâ‚„ + bâ‚ƒxâ‚† + bâ‚„xâ‚ˆ)
```

**ê° elementë³„ ë¯¸ë¶„:**
```
âˆ‚f/âˆ‚aâ‚ = xâ‚
âˆ‚f/âˆ‚aâ‚‚ = xâ‚ƒ
âˆ‚f/âˆ‚aâ‚ƒ = xâ‚…
âˆ‚f/âˆ‚aâ‚„ = xâ‚‡

âˆ‚f/âˆ‚bâ‚ = xâ‚‚
âˆ‚f/âˆ‚bâ‚‚ = xâ‚„
âˆ‚f/âˆ‚bâ‚ƒ = xâ‚†
âˆ‚f/âˆ‚bâ‚„ = xâ‚ˆ
```

**Gradient í–‰ë ¬:**
```
âˆ‚f/âˆ‚A = [xâ‚ xâ‚ƒ xâ‚… xâ‚‡]  =  X^T  (4Ã—2ë¥¼ ì „ì¹˜ â†’ 2Ã—4)
        [xâ‚‚ xâ‚„ xâ‚† xâ‚ˆ]
```

**ê³µì‹:**
```
âˆ‚tr(AX)/âˆ‚A = X^T  â† í•­ìƒ Aì™€ ê°™ì€ í¬ê¸°! (2Ã—4)
```

---

## ğŸ” ì™œ ì´ë ‡ê²Œ ë˜ëŠ”ê°€? (ì§ê´€ì  ì´í•´)

### í•µí•µì‹¬ ì›ë¦¬

```
tr(AX) = Î£áµ¢ Î£â±¼ Aáµ¢â±¼ Xâ±¼áµ¢
```

**íŠ¹ì • element `Aâ‚–â‚—`ì— ëŒ€í•œ í¸ë¯¸ë¶„:**
```
âˆ‚tr(AX)/âˆ‚Aâ‚–â‚— = Xâ‚—â‚–
```

**ì´ìœ :**
- `tr(AX)`ëŠ” `A`ì˜ ëª¨ë“  elementë“¤ì˜ **ì„ í˜• ì¡°í•©**
- `Aâ‚–â‚—`ì€ `tr(AX)`ì—ì„œ `Xâ‚—â‚–`ì™€ ê³±í•´ì§
- ë”°ë¼ì„œ ê³„ìˆ˜ê°€ `Xâ‚—â‚–`

**í–‰ë ¬ í˜•íƒœë¡œ ì“°ë©´:**
```
(âˆ‚f/âˆ‚A)â‚–â‚— = Xâ‚—â‚– = (X^T)â‚–â‚—

âˆ´ âˆ‚f/âˆ‚A = X^T
```

---

## ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì´í•´í•˜ê¸°

### 2Ã—2 ì˜ˆì œ

```
          ë¯¸ë¶„ ëŒ€ìƒ
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ a    b  â”‚ 
    A = â”‚         â”‚  (2Ã—2)
        â”‚ c    d  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Ã—
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ w    x  â”‚
    X = â”‚         â”‚  (2Ã—2)
        â”‚ y    z  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   AX = â”‚aw+by  * â”‚  (2Ã—2)
        â”‚   *  cx+dzâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
   tr(AX) = aw+by + cx+dz  (scalar)
              â†“
   âˆ‚/âˆ‚Aë¥¼ êµ¬í•˜ë ¤ë©´ ê° elementë³„ë¡œ:

   âˆ‚/âˆ‚a = w â”€â”€â”
   âˆ‚/âˆ‚b = y â”€â”€â”¤
               â”œâ”€â”€â†’ âˆ‚f/âˆ‚A = [w  y] = X^T
   âˆ‚/âˆ‚c = x â”€â”€â”¤            [x  z]
   âˆ‚/âˆ‚d = z â”€â”€â”˜
```

---

## ğŸ’¡ ì‹¤ì „ íŒ

### Tip 1: Shape ì²´í¬ê°€ í•µì‹¬!

```
A: mÃ—n
X: nÃ—p

AX: mÃ—p (í–‰ë ¬)
tr(AX): scalar (ëŒ€ê° ì›ì†Œ í•©, m=pì¼ ë•Œë§Œ)

âˆ‚tr(AX)/âˆ‚A: mÃ—n (Aì™€ ê°™ì€ í¬ê¸°!) âœ…
```

### Tip 2: Elementë³„ ê³„ì‚° â†’ íŒ¨í„´ ì°¾ê¸°

1. **2Ã—2 ì˜ˆì œë¡œ ì‹œì‘**: ì†ìœ¼ë¡œ ê³„ì‚°
2. **íŒ¨í„´ ë°œê²¬**: ëŒ€ë¶€ë¶„ `X^T` í˜•íƒœ
3. **ì¼ë°˜í™”**: ê³µì‹ ì ìš©

### Tip 3: Numerical Gradientë¡œ ê²€ì¦!

```python
# ê°„ë‹¨í•œ ê²€ì¦ ì½”ë“œ (Jupyterì—ì„œ ì‹¤í–‰)
import numpy as np

def verify_gradient(A, X):
    """âˆ‚tr(AX)/âˆ‚A = X^T ê²€ì¦"""
    
    # Analytical
    grad_analytical = X.T
    
    # Numerical
    eps = 1e-5
    grad_numerical = np.zeros_like(A)
    
    for i in range(A.shape[0]):
        for j in range(A.shape[1]):
            A_plus = A.copy()
            A_plus[i,j] += eps
            f_plus = np.trace(A_plus @ X)
            
            A_minus = A.copy()
            A_minus[i,j] -= eps
            f_minus = np.trace(A_minus @ X)
            
            grad_numerical[i,j] = (f_plus - f_minus) / (2*eps)
    
    print("Analytical:\n", grad_analytical)
    print("\nNumerical:\n", grad_numerical)
    print("\nError:", np.max(np.abs(grad_analytical - grad_numerical)))

# í…ŒìŠ¤íŠ¸
A = np.random.randn(2, 4)
X = np.random.randn(4, 2)
verify_gradient(A, X)
```

---

## ğŸ“š ìì£¼ ì“°ëŠ” ê³µì‹ ëª¨ìŒ

| í•¨ìˆ˜ `f(A)` | Gradient `âˆ‚f/âˆ‚A` | ì¡°ê±´ | Shape |
|------------|-----------------|------|--------|
| `tr(A)` | `I` | | `nÃ—n` |
| `tr(AB)` | `B^T` | B ê³ ì • | Same as A |
| `tr(A^T B)` | `B` | B ê³ ì • | Same as A |
| `â€–Aâ€–_F^2` | `2A` | | Same as A |
| `tr(ABA^T)` | `2AB` | B ëŒ€ì¹­ | Same as A |
| `â€–AX-Bâ€–_F^2` | `2(AX-B)X^T` | X,B ê³ ì • | Same as A |

---

## ğŸ§® ì—°ìŠµ ë¬¸ì œ

### ë¬¸ì œ 1: ì§ì ‘ ê³„ì‚°í•´ë³´ê¸°

```
A = [1  2]    X = [5  6]
    [3  4]        [7  8]

f(A) = tr(AX)
```

**í’€ì´:**
1. `AX = ?`
2. `tr(AX) = ?`
3. `âˆ‚f/âˆ‚A = ?` (elementë³„ë¡œ)
4. `X^T = ?`
5. ë¹„êµ!

<details>
<summary>ë‹µ ë³´ê¸°</summary>

```
AX = [1Â·5+2Â·7  1Â·6+2Â·8] = [19  22]
     [3Â·5+4Â·7  3Â·6+4Â·8]   [43  50]

tr(AX) = 19 + 50 = 69

âˆ‚f/âˆ‚A = [5  7] = X^T âœ…
        [6  8]
```
</details>

### ë¬¸ì œ 2: ë‹¤ë¥¸ í¬ê¸° í–‰ë ¬

```
A = [1  2  3]    X = [4  5]
    [4  5  6]        [6  7]
                     [8  9]

f(A) = tr(AX)
âˆ‚f/âˆ‚A = ?
```

<details>
<summary>ë‹µ ë³´ê¸°</summary>

```
X^T = [4  6  8]  (2Ã—3, Aì™€ ê°™ì€ í¬ê¸°!)
      [5  7  9]

âˆ‚f/âˆ‚A = X^T
```
</details>

---

## âœ… ìš”ì•½

### ë‹¹ì‹ ì˜ ì§ˆë¬¸ì— ëŒ€í•œ ìµœì¢… ë‹µë³€

> **"ë‘ ê°œê°€ ëª¨ë‘ í–‰ë ¬ì¼ ë•Œ ê° elementë¥¼ ë¯¸ë¶„í•´ì•¼ í•˜ë‚˜?"**

**ë‹µ:**
1. âœ… **ë„¤, ê° elementë³„ë¡œ âˆ‚f/âˆ‚Aáµ¢â±¼ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤**
2. âœ… **í•˜ì§€ë§Œ íŒ¨í„´ì´ ìˆì–´ì„œ ê³µì‹ìœ¼ë¡œ ê°„ë‹¨íˆ ê³„ì‚° ê°€ëŠ¥í•©ë‹ˆë‹¤**
3. âœ… **ëŒ€ë¶€ë¶„ì˜ ê²½ìš° `X^T` ë˜ëŠ” ê°„ë‹¨í•œ ë³€í˜•ì…ë‹ˆë‹¤**

### í—·ê°ˆë¦¬ì§€ ì•ŠëŠ” ë²•

1. **Shape ë¨¼ì €**: Aê°€ mÃ—nì´ë©´ âˆ‚f/âˆ‚Aë„ mÃ—n
2. **ì‘ì€ ì˜ˆì œ**: 2Ã—2ë¡œ ì† ê³„ì‚°
3. **ê³µì‹ ì™¸ìš°ê¸°**: ìì£¼ ì“°ëŠ” ê²ƒë§Œ (tr(AB) = B^T ë“±)
4. **ê²€ì¦**: Numerical gradientë¡œ í™•ì¸

### ë‹¤ìŒ ë‹¨ê³„

- 01_matrix_gradients.ipynbì—ì„œ ì½”ë“œë¡œ ì‹¤ìŠµ
- Trace trick ë§ˆìŠ¤í„°í•˜ê¸°
- Chain ruleë¡œ ë³µì¡í•œ ê²½ìš° í’€ê¸°

---

**ì´ì œ ëª…í™•í•´ì¡Œë‚˜ìš”?** ğŸ‰

ì¶”ê°€ ì§ˆë¬¸ì´ ìˆìœ¼ë©´ ì–¸ì œë“ ì§€ ë¬¼ì–´ë³´ì„¸ìš”!
